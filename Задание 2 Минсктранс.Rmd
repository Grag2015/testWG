## Анализ жалобы от пассажиров на плохую работу транспорта на диспетчерской станции «Дружная» в период с 20:00 до 21:00.

выполнил: *Григорий Михолап*  
дата: *09/12/2015*


**Задание:**

В «Минсктранс» поступила жалоба от пассажиров на плохую работу транспорта на диспетчерской станции «Дружная» в период с 20:00 до 21:00. Суть жалобы состоит в том, что троллейбусы ходят не по расписанию и их приходится ждать очень долго на остановках. Необходимо разобраться в ситуации и выяснить, чем же вызвана жалоба, а также провести развернутый анализ времени движения транспорта и пассажиропотока.

Выводы кратко: Расписание выдерживается нормально в среднем на станции ..., 
Пассажиропоток
Интервал движения
Время ожидания
Проблема в том, что расписание для маршрута 51 не обеспечивает ...

## Загрузка и подготовка данных для анализа
**Замечание** для воспроизводимости работы:
перед загрузкой вкладка "Статистика по троллейбусам" была сохранена в формате csv
в файле с именем "Data Analyst (Financial) TZ Data_TMO.csv"
(Выполнено в MS Excel 2010: Файл -> Сохранить как -> CSV (разделители - запятые))
```{r}
#  setwd("d:/Grag/R/R-studio/testwg/")
df <-  read.csv("Data Analyst (Financial) TZ Data_TMO.csv", sep = ";")
# переименуем столбцы
names(df) <- c("number","time","pass")
# преобразуем время к внутреннему формату для хранения дат
df$time <- strptime(df$time, format = "%H:%M")

```

```{r results='hide', warning=FALSE, message=FALSE}
# Подключаем нужные библиотеки
library("dplyr")
library("ggplot2")
library("lattice") 
library("xtable")
library("car")
library(lubridate)
```

Рассчитываем интервалы движения (данные вносим в дополнительный столбец `interval`)
```{r}
df$interval <- numeric(length = nrow(df))
for (i in 1:length(unique(df$number))) {
    temp <- df[df$number==unique(df$number)[i],"time"]
    temp2 <- numeric(length = length(temp))
    for (j in 2:length(temp)) {        
        temp2[j]=as.integer(temp[j]-temp[j-1])
    }
    is.na(temp2[1]) <- T
    df[df$number==unique(df$number)[i],]$interval <- temp2
}
```

Дополнительно добавим такой показатель, как время ожидания в пассажиро-минутах
```{r}
df$passmin <- df$pass*df$interval
wait <- integer(length = 6)
for (i in 1:6) {
    wait[i] <- sum(df[minute(df$time)+(hour(df$time)-20)*60>=(i-1)*10 & 
                          minute(df$time)+(hour(df$time)-20)*60<(i)*10,"passmin"], na.rm = T)
}
```


## Общие характеристики работы транспорта на диспетчерской станции «Дружная» в период с 20:00 до 21:00. 
Числовые характеристики
```{r}
summary(df$interval)
sd(df$interval, na.rm = T)
```
В среднем интервал ожидания троллейбуса на станции "Дружная" в период с 20:00 до
21:00 составляет 5 минут, при этом в реальности троллейбусы по ряду причин не 
всегда зависящих от водителя, могут отклониться от среднего, т.е. прибыть раньше
либо позже. Среднее значение такого отклонения составляет
примерно 1.7 минуты

Просмотр данных
```{r}
ggplot(data = df, aes(x=interval))+geom_histogram(binwidth = 1, col="white")+ylim(0,15)+xlim(0,15)+
    geom_vline(xintercept = mean(df$interval, na.rm = T), colour="red", linetype = "longdash", size=2)+xlab("Интервал мин.")+ylab("Количество прибытий в указанном интервале")
```
```{r}
ggplot(data = df, aes(x=time, y=passmin))+geom_line(aes(col=factor(number)))+geom_point(aes(col=factor(number)))

ggplot(data = df, aes(x=time, y=pass))+geom_line(aes(col=factor(number)))+geom_point(aes(col=factor(number)))


```

Характеристики работы транспорта по каждому маршруту
Числовые характеристики
```{r}
tapply(df$interval, df$number, summary)
tapply(df$interval, df$number, function(e) sd(e, na.rm = T))
```


Просмотр данных
```{r}
ggplot(data = df, aes(x=interval))+geom_histogram(binwidth = 1, col="white")+facet_grid(number~.)+
    xlim(0,15)
```
здесь мы видим, что для маршрутов 27 и 31 в среднем интервал ожидания составляет
5 и 4 минуты соответственно, при этом отклонение от среднего интервала (в большую
или меньшую сторону) составляет примерно около 1 минуты (а точнее 0.8 и 0.9 мин 
соответственно), в целом данные маршруты в течение исследуемого промежутка времени, 
показывают результат лучше, чем средний по станции.